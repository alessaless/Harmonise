<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>QTrobot - Volume + Italiano + Say</title>
    <script src="js/roslib.min.js"></script>
</head>
<body>
<script>
    // === Configura qui, se serve ===
    var ROSBRIDGE_URL = 'ws://192.168.100.2:9091';
    var TARGET_VOLUME = 75; // 0..100
    var LANGUAGE     = 'it-IT';
    var MESSAGE_TEXT = 'CIAO A TUTTI';

    var ros = new ROSLIB.Ros({ url : ROSBRIDGE_URL });

    ros.on('connection', function () {
      console.log('Connected to rosbridge:', ROSBRIDGE_URL);

      // 1) Imposta il volume
      var setVol = new ROSLIB.Service({
        ros : ros,
        name : '/qt_robot/setting/setVolume',
        serviceType : 'qt_robot_interface/setting_setVolume'
      });

      setVol.callService(
        new ROSLIB.ServiceRequest({ volume: TARGET_VOLUME }),
        function (res) {
          console.log('Volume impostato:', TARGET_VOLUME, res);

          // 2) Imposta la lingua (italiano)
          var speechConfig = new ROSLIB.Service({
            ros : ros,
            name : '/qt_robot/speech/config',
            serviceType : 'qt_robot_interface/speech_config'
          });

          speechConfig.callService(
            new ROSLIB.ServiceRequest({ language: LANGUAGE }),
            function (res2) {
              console.log('Lingua impostata:', LANGUAGE, res2);

              // 3) Parla in italiano
              var say = new ROSLIB.Service({
                ros : ros,
                name : '/qt_robot/speech/say',
                serviceType : 'qt_robot_interface/speech_say'
              });

              say.callService(
                new ROSLIB.ServiceRequest({ message : MESSAGE_TEXT }),
                function (res3) {
                  console.log('Speech OK', res3);

                  // 4) (Opzionale) Mostra emozione happy
                  var emo = new ROSLIB.Service({
                    ros : ros,
                    name : '/qt_robot/emotion/show',
                    serviceType : 'qt_robot_interface/emotion_show'
                  });
                  emo.callService(
                    new ROSLIB.ServiceRequest({ name : 'QT/happy' }),
                    function (res4) { console.log('Emotion OK', res4); },
                    function (err4) { console.error('Emotion ERR', err4); }
                  );
                },
                function (err3) { console.error('Speech ERR', err3); }
              );
            },
            function (err2) { console.error('speech/config ERR', err2); }
          );
        },
        function (err) { console.error('setVolume ERR', err); }
      );
    });

    ros.on('error', function (e) { console.error('WS error', e); });
    ros.on('close', function () { console.log('WS closed'); });
</script>

<p style="font-family: sans-serif;">
    Apri la console del browser per vedere i log (F12 â†’ Console).
</p>
</body>
</html>
